# Multi-stage Dockerfile for testing Renovate with multiple digests
FROM node:18-alpine@sha256:435dcad253bb5b7f347ebc69c8cc52de7c912eb7241098b920f2fc2d7843183d AS builder

WORKDIR /build

COPY package*.json ./
RUN npm ci --only=production

# Final stage
FROM alpine:3.19@sha256:6457d53fb065d6f250e1504b9bc42d5b6c65941d57532c072d929dd0628977d0

RUN apk add --no-cache nodejs

WORKDIR /app

COPY --from=builder /build/node_modules ./node_modules
COPY . .

CMD ["node", "server.js"]
